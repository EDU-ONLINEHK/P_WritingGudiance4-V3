<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½œæ–‡å¤§ç¶±äº’å‹•ç¶²é </title>
    <style>
        /* --------------------------------------------------
           Core styles (Neubrutalism)
        -------------------------------------------------- */
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #f3f4f6; /* light gray */
            color: #111827;
        }
        a { color: inherit; text-decoration: none; }

        .card-brutal {
            border: 4px solid #000;
            box-shadow: 8px 8px 0 #000;
            background: #fff;
        }
        .btn-brutal {
            border: 2px solid #000;
            box-shadow: 4px 4px 0 #000;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.1s ease;
            background: #fde68a;
        }
        .btn-brutal:hover {
            filter: brightness(0.95);
        }
        .btn-brutal:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        /* Layout: sidebar + main */
        #sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 260px;
            background: #fff;
            border-right: 4px solid #000;
            padding: 1rem;
            transition: width 0.3s ease;
            z-index: 20;
        }
        #sidebar.collapsed {
            width: 96px;
        }
        #sidebar-content {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        #nav-toggle {
            align-self: flex-end;
            border: 2px solid #000;
            background: #fbbf24;
            padding: 0.25rem;
            cursor: pointer;
            margin-bottom: 0.5rem;
        }
        #nav-toggle svg {
            width: 18px;
            height: 18px;
        }

        .group-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        .group-selector button {
            flex: 1;
            padding: 0.25rem 0.5rem;
            font-size: 0.9rem;
        }
        .group-selector button.active {
            background: #facc15;
        }

        .font-size-container {
            margin-bottom: 0.75rem;
            font-size: 0.85rem;
        }
        .font-size-container input[type="range"] {
            width: 100%;
        }

        #highlight-toggle {
            border: 2px solid #000;
            padding: 0.25rem;
            background: #e5e7eb;
            cursor: pointer;
            margin-bottom: 0.75rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        #highlight-toggle svg {
            width: 20px;
            height: 20px;
        }

        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
            margin-top: 0.5rem;
        }
        .sidebar-nav button {
            width: 100%;
            text-align: left;
            padding: 0.4rem 0.5rem;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            border-radius: 0.25rem;
            margin-bottom: 0.25rem;
        }
        .sidebar-nav button:hover {
            background: #fee2e2;
        }
        .sidebar-nav button.active {
            background: #fecaca;
            border-left: 4px solid #000;
        }

        .main-content {
            margin-left: 260px;
            padding: 1.5rem 1.5rem 3rem;
            transition: margin-left 0.3s ease;
        }
        .main-content.compact {
            margin-left: 96px;
        }

        .section {
            margin-top: 1.5rem;
            padding: 1rem 1.25rem;
        }
        .section h2 {
            margin-top: 0;
            margin-bottom: 0.75rem;
        }

        /* Floating timer */
        #floating-timer {
            position: fixed;
            right: 24px;
            bottom: 80px;
            width: 64px;
            height: 64px;
            border-radius: 999px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            cursor: grab;
            box-shadow: 4px 4px 0 #000;
            border: 2px solid #000;
            z-index: 50;
        }
        #floating-timer.expanded {
            width: 280px;
            height: auto;
            border-radius: 0.75rem;
            box-shadow: 8px 8px 0 #000;
            flex-direction: column;
            cursor: default;
        }
        .floating-timer-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.4rem 0.6rem;
            background: #e5e7eb;
            border-bottom: 3px solid #000;
            border-radius: 0.75rem 0.75rem 0 0;
        }
        .floating-timer-header span {
            font-weight: 900;
            font-size: 0.95rem;
        }
        .timer-icon-btn {
            border: 2px solid #000;
            background: #fbbf24;
            padding: 0.2rem;
            cursor: pointer;
        }
        .timer-icon-btn svg {
            width: 16px;
            height: 16px;
        }
        .timer-progress {
            width: 100%;
            height: 4px;
            background: #e5e7eb;
            border-top: 3px solid #000;
        }
        .timer-progress-fill {
            height: 4px;
            width: 100%;
            border-top: 3px solid #000;
        }
        #timer-display {
            font-size: 2.2rem;
            text-align: center;
            padding: 0.4rem 0;
            font-weight: 900;
        }
        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 0.4rem;
            padding-bottom: 0.6rem;
        }
        .timer-controls button {
            font-size: 0.85rem;
            padding: 0.25rem 0.6rem;
        }
        .animate-shake {
            animation: shake 0.4s ease-in-out infinite;
        }
        @keyframes shake {
            0%,100% { transform: translateX(0); }
            25% { transform: translateX(-3px) rotate(-2deg); }
            75% { transform: translateX(3px) rotate(2deg); }
        }

        /* Checklist */
        .checklist-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 0.4rem;
            font-size: 0.9rem;
        }
        .checklist-item input {
            margin-right: 0.5rem;
            margin-top: 0.1rem;
        }

        /* Learning objectives accordion */
        .lo-accordion {
            margin-top: 1rem;
            border: 4px solid #000;
            box-shadow: 6px 6px 0 rgba(0,0,0,0.2);
            background: #fff;
        }
        .lo-accordion-header {
            padding: 0.5rem 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-weight: 900;
            background: #e0e7ff;
            border-bottom: 4px solid #000;
        }
        .lo-accordion-header span {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
        }
        .lo-accordion-body {
            padding: 0.75rem;
        }
        .lo-item {
            display: flex;
            gap: 0.6rem;
            padding: 0.4rem 0.5rem;
            border: 2px solid #000;
            margin-bottom: 0.4rem;
        }
        .lo-item-tag {
            padding: 0.15rem 0.4rem;
            font-size: 0.75rem;
            font-weight: 900;
            border: 2px solid #000;
            white-space: nowrap;
        }
        .lo-item-content h4 {
            margin: 0;
            font-size: 0.95rem;
        }
        .lo-item-content p {
            margin: 0.1rem 0 0;
            font-size: 0.85rem;
        }

        /* Quiz */
        #quiz-content button {
            font-size: 0.9rem;
        }

        /* Simple utility */
        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .items-center { align-items: center; }
        .gap-2 { gap: 0.5rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .text-sm { font-size: 0.875rem; }
        .font-bold { font-weight: 700; }
        .font-black { font-weight: 900; }
        .w-full { width: 100%; }
        .hidden { display: none; }

        footer {
            text-align: center;
            padding: 1.5rem 0 0.5rem;
            border-top: 4px solid #000;
            margin-top: 2rem;
            font-size: 0.85rem;
            color: #6b7280;
            background: #fff;
        }

        @media (max-width: 768px) {
            #sidebar {
                position: fixed;
                width: 220px;
                z-index: 30;
            }
            #sidebar.collapsed {
                width: 72px;
            }
            .main-content {
                margin-left: 72px;
                padding: 1rem 0.75rem 3rem;
            }
            .main-content.compact {
                margin-left: 72px;
            }
        }
    </style>
</head>
<body>
<div id="app">
    <!-- Sidebar -->
    <aside id="sidebar">
        <div id="sidebar-content">
            <button id="nav-toggle" aria-label="toggle sidebar">
                <svg id="chevron-open" xmlns="http://www.w3.org/2000/svg" fill="none"
                     viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M9 5l7 7-7 7"/>
                </svg>
                <svg id="chevron-closed" class="hidden" xmlns="http://www.w3.org/2000/svg" fill="none"
                     viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M15 19l-7-7 7-7"/>
                </svg>
            </button>

            <!-- Group selector -->
            <div class="group-selector">
                <button id="group-A" class="btn-brutal active" data-group="A">A çµ„</button>
                <button id="group-B" class="btn-brutal" data-group="B">B çµ„</button>
            </div>

            <!-- Font slider -->
            <div class="font-size-container">
                <div class="flex justify-between items-center mb-2">
                    <span>å­—é«”å¤§å°</span>
                    <span id="font-size-label" class="text-sm">20px</span>
                </div>
                <input type="range" id="fontSlider" min="14" max="30" value="20">
            </div>

            <!-- Highlight toggle -->
            <button id="highlight-toggle" title="é¡¯ç¤º/éš±è—é‡é»">
                <!-- eye icon default -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                     viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274
                           4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                </svg>
            </button>

            <!-- Section nav -->
            <nav class="sidebar-nav" id="sidebar-nav"></nav>
        </div>
    </aside>

    <!-- Main -->
    <main id="main-content" class="main-content">
        <header class="card-brutal section" style="margin-top: 0;">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="font-black" style="margin:0 0 0.3rem;">ä½œæ–‡å¤§ç¶±äº’å‹•ç¶²é ï¼ˆéœæ…‹å…‹éš†ç‰ˆï¼‰</h1>
                    <p class="text-sm" style="margin:0;">
                        æ¨¡ä»¿åŸç‰ˆ React + Tailwind äº’å‹•ç¶²é ï¼Œä»¥ç´” HTML/CSS/JS å¯¦ä½œã€‚
                    </p>
                </div>
                <div class="text-sm font-bold">
                    <span id="current-group-label">ç•¶å‰æ¨¡å¼ï¼šA çµ„æŒ‘æˆ°</span>
                </div>
            </div>
        </header>

        <!-- Timer -->
        <div id="floating-timer">
            <!-- æ”¶åˆç‹€æ…‹åªé¡¯ç¤ºåœ–ç¤ºï¼Œå±•é–‹å…§å®¹ç”± JS æ§åˆ¶ -->
            <svg id="timer-icon-mini" xmlns="http://www.w3.org/2000/svg" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 8v4l3 3m1-9V5a1 1 0 00-1-1h-1V3a1 1 0 10-2 0v1H9a1 1 0 00-1 1v1m11
                       4a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
        </div>

        <!-- Sections -->
        <section id="intro" class="section card-brutal">
            <h2 class="font-black text-xl">ğŸ‘©â€ğŸ« æ•™å¸«å¼•å°</h2>
            <p id="intro-text">
                é€™ä¸€é ç¤ºç¯„å¦‚ä½•ç”¨å¤§ç¶±æ€ç¶­å¯«ä½œï¼šå¤§ç¶±å°±åƒ
                <span class="hl">Google Maps çš„è·¯ç·šå°èˆª</span>ï¼Œå…ˆæƒ³æ¸…æ¥šã€Œè¦å»å“ªè£¡ã€ï¼Œ
                æ‰ä¸æœƒå¯«åˆ°ä¸€åŠè¿·è·¯ã€æ²’é‡é»ã€‚
            </p>
            <div id="lo-accordion-root"></div>
        </section>

        <section id="prompt" class="section card-brutal">
            <h2 class="font-black text-xl">ğŸ“ é¡Œç›®æ‹†è§£ï¼ˆPrompt Game ç°¡åŒ–ç¤ºä¾‹ï¼‰</h2>
            <div id="prompt-content"></div>
        </section>

        <section id="structure" class="section card-brutal">
            <h2 class="font-black text-xl">ğŸš€ å¤§ç¶±é•·ç›¸</h2>
            <p>
                é€™è£¡å¯ä»¥æ”¾ã€Œæ®µè½çµæ§‹åœ–ã€ã€ã€Œé–‹é ­ï¼ä¸­æ®µï¼çµå°¾ç¤ºç¯„ã€ç­‰éœæ…‹å…§å®¹ã€‚ä½ å¯ä»¥ä¾
                ç…§å¯¦éš›æ•™æ¡ˆæ›¿æ›æ–‡å­—èˆ‡åœ–ç¤ºã€‚
            </p>
        </section>

        <section id="inspiration" class="section card-brutal">
            <h2 class="font-black text-xl">ğŸ’¡ éˆæ„Ÿæ€¥æ•‘</h2>
            <p>
                è‹¥å­¸ç”Ÿæ²’æœ‰é¡Œæï¼Œå¯ä»¥æä¾›ã€Œç”Ÿæ´»äº‹ä»¶æ¸…å–®ã€ã€ã€Œæ„Ÿå—è©åº«ã€æˆ–ã€Œå¸¸è¦‹ç«‹æ„æ–¹å‘ã€
                ä¾›åƒè€ƒã€‚æ­¤å€ä»¥ç´”éœæ…‹å…§å®¹é…åˆå­—é«”å¤§å°èˆ‡é«˜äº®æ§åˆ¶å³å¯ã€‚
            </p>
        </section>

        <section id="demo" class="section card-brutal">
            <h2 class="font-black text-xl">ğŸ”¥ å¯¦æˆ°ç¤ºç¯„</h2>
            <p>
                é€™è£¡æ”¾ä¸€ç¯‡ç¤ºç¯„å¤§ç¶±æˆ–çŸ­æ–‡ï¼Œæ­é…é¡è‰²å€å¡Šæ¨™è¨»ã€Œç¶“æ­·ã€ã€Œç›®æ¨™ã€ã€Œåæ€ã€ã€Œæ˜‡è¯ã€
                ç­‰éƒ¨åˆ†ï¼Œé€é
                <span class="hl">é«˜äº®æ¨™è¨˜</span>
                å¹«åŠ©å­¸ç”Ÿè¦–è¦ºåŒ–çµæ§‹ã€‚
            </p>
        </section>

        <section id="checklist" class="section card-brutal">
            <h2 class="font-black text-xl">âœ… è‡ªæª¢æ¸…å–®</h2>
            <div id="checklist-content"></div>
        </section>

        <section id="quiz" class="section card-brutal">
            <h2 class="font-black text-xl">ğŸ® äº’å‹•æ¸¬é©—</h2>
            <div id="quiz-content"></div>
        </section>

        <footer>
            <p class="font-black">DSE ä¸­æ–‡å¯«ä½œåŠ æ²¹ç«™ â€“ éœæ…‹å…‹éš†ç¤ºä¾‹</p>
            <p>è¨­è¨ˆé¢¨æ ¼ï¼šNeubrutalismï¼å¯è‡ªç”±æ“´å……æ›´å¤šéŠæˆ²èˆ‡æ•™ææ¨¡çµ„</p>
        </footer>
    </main>
</div>

<script>
(function () {
    // ---------------- Data Definitions ----------------
    const CHECKLIST_ITEMS = [
        "æ‹’çµ•åªå¯«å£è™Ÿå¥ï¼šæœ‰æ²’æœ‰ç”¨å…·é«”ç•«é¢æˆ–å‹•ä½œè¡¨ç¾æ„Ÿå—ï¼Ÿ",
        "ã€Œæˆ‘å¾ˆä¸é–‹å¿ƒã€é€™é¡å¥å­å¾Œé¢ï¼Œæœ‰æ²’æœ‰èªªæ˜åŸå› ï¼Ÿ",
        "ç›®æ¨™æ˜¯å¦å…·é«”å¯è¡Œï¼Œä¾‹å¦‚ã€Œæ¯å¤©ç·´ç¿’ 20 åˆ†é˜ã€è€Œä¸æ˜¯ã€Œæˆ‘è¦è®Šå²å®³ã€ï¼Ÿ",
        "æœ‰æ²’æœ‰æŠ“ä½é¡Œç›®é—œéµè©ï¼ˆæ™‚é–“ã€äººç‰©ã€é™åˆ¶ï¼‰ä¾†é¸æï¼Ÿ",
        "ç¶“æ­·èˆ‡ç›®æ¨™ä¹‹é–“ï¼Œæœ‰æ²’æœ‰æ¸…æ¥šçš„å› æœé—œä¿‚ï¼Ÿ"
    ];

    const GAME_QUESTIONS_A = [
        {id: 1, text: "æˆ‘å¾ˆå‚·å¿ƒã€‚", type: "vague", explanation: "å¤ªç± çµ±ï¼æ²’æœ‰ç•«é¢æ„Ÿï¼Œè®€è€…æ„Ÿå—ä¸åˆ°ä½ çš„å¿ƒæƒ…ã€‚"},
        {id: 2, text: "çœ¼æ·šåœ¨çœ¼ç«æ‰“è½‰ï¼Œæˆ‘å’¬è‘—å˜´å”‡ä¸è®“å®ƒæµä¸‹ä¾†ã€‚", type: "concrete", explanation: "å¾ˆå¥½ï¼æœ‰å‹•ä½œï¼ˆå’¬å˜´å”‡ï¼‰å’Œç•«é¢ï¼ˆçœ¼æ·šæ‰“è½‰ï¼‰ã€‚"},
        {id: 3, text: "é‚£å¤©çš„é›¨ä¸‹å¾—å¾ˆå¤§ã€‚", type: "vague", explanation: "ã€Œå¾ˆå¤§ã€æ˜¯å¤šå¤§ï¼Ÿæ¯å€‹äººæƒ³åƒçš„éƒ½ä¸ä¸€æ¨£ã€‚"},
        {id: 4, text: "å†°å†·çš„é›¨æ°´æ‰“åœ¨è‡‰ä¸Šï¼Œåƒé‡åˆºä¸€æ¨£ç—›ã€‚", type: "concrete", explanation: "å…·é«”ï¼é‹ç”¨äº†è§¸è¦ºå’Œæ¯”å–»ï¼Œç•«é¢æ„Ÿå¼·ã€‚"},
        {id: 5, text: "æˆ‘è¦åšå€‹è² è²¬ä»»çš„äººã€‚", type: "vague", explanation: "ç©ºè©±ï¼æ€æ¨£æ‰ç®—è² è²¬ï¼Ÿæ²’æœ‰å…·é«”è¡Œå‹•ã€‚"},
        {id: 6, text: "æˆ‘æœƒä¸»å‹•æ‰¿æ“”æ¸…æ´—ç¢—ç¢Ÿçš„å·¥ä½œï¼Œä¸å†æ¨å¸çµ¦åª½åª½ã€‚", type: "concrete", explanation: "æœ‰æ˜ç¢ºçš„è¡Œå‹•ï¼ˆæ´—ç¢—ï¼‰å’Œæ”¹è®Šã€‚"}
    ];
    const GAME_QUESTIONS_B = JSON.parse(JSON.stringify(GAME_QUESTIONS_A));

    const PROMPT_INFO_B = {
        fullTitle: "å› ç‚ºé€™ä¸€å¤©çš„ç¶“æ­·ï¼Œæˆ‘å®šä¸‹ä¸€å€‹ç›®æ¨™ï¼Œå°±æ˜¯è¦æ±ºå¿ƒæ”¹æ‰è¡å‹•çš„æ€§æ ¼ã€‚",
        requirements: [
            "å­—æ•¸ï¼šä¸å¾—å°‘æ–¼ 250 å­—",
            "äººç¨±ï¼šç¬¬ä¸€äººç¨±ã€Œæˆ‘ã€",
            "é‡é»å®šç¾©ï¼šã€Œè¡å‹•ã€æŒ‡æƒ…ç·’æ¿€å‹•è€Œæœªç¶“ç†æ€§æ€è€ƒçš„è¡Œç‚º"
        ],
        gameWords: [
            { id: 1, text: "å› ç‚º", important: false },
            { id: 2, text: "é€™ä¸€å¤©", important: true },
            { id: 3, text: "çš„", important: false },
            { id: 4, text: "ç¶“æ­·", important: true },
            { id: 5, text: "ï¼Œ", important: false },
            { id: 6, text: "æˆ‘", important: true },
            { id: 7, text: "å®šä¸‹", important: false },
            { id: 8, text: "ä¸€å€‹", important: true },
            { id: 9, text: "ç›®æ¨™", important: true },
            { id: 10, text: "ã€‚", important: false }
        ],
        gameLogicQ: "ç‚ºä»€éº¼é¡Œç›®è¦å¼·èª¿ã€Œå› ç‚ºã€é€™ä¸€å¤©çš„ç¶“æ­·ï¼Ÿ",
        gameConstraintQ: "é¡Œç›®è¦å®šã€Œä¸€å€‹ã€ç›®æ¨™ï¼Œå¦‚æœä¸å°å¿ƒå¯«äº†å…©å€‹æœƒæ€æ¨£ï¼Ÿ"
    };

    const LEARNING_OBJECTIVES = [
        { level: "Lv.1", title: "åŸºç¤èƒ½åŠ›ï¼šå¯©é¡Œç²¾æº–", desc: "èƒ½æº–ç¢ºç†è§£é¡Œç›®è¦æ±‚ï¼Œé¸å–ç¬¦åˆã€ŒæŸä¸€å¤©ã€ã€Œä¸€å€‹ç›®æ¨™ã€é™åˆ¶çš„ç´ æï¼Œä¸é›¢é¡Œã€‚", required: "ALL" },
        { level: "Lv.2", title: "æº–å‚™èƒ½åŠ›ï¼šå…·é«”æå¯«", desc: "å–„ç”¨äº”æ„Ÿæå¯«èˆ‡å¿ƒç†åˆ»ç•«ï¼Œè®“äº‹ä»¶éç¨‹ç”Ÿå‹•å…·é«”ï¼Œæ‹’çµ•æµæ°´å¸³ã€‚", required: "ALL" },
        { level: "Lv.3", title: "æ ¸å¿ƒèƒ½åŠ›ï¼šé‚è¼¯è²«é€š", desc: "èƒ½å»ºç«‹ã€Œç¶“æ­·ã€èˆ‡ã€Œç›®æ¨™ã€ä¹‹é–“åˆç†çš„å› æœé—œä¿‚ï¼Œæ•™è¨“èˆ‡æ”¹è®Šé‚è¼¯è‡ªæ´½ã€‚", required: "ALL" },
        { level: "Lv.4", title: "æŒ‘æˆ°ç›®æ¨™ï¼šæ·±åº¦æ˜‡è¯", desc: "èƒ½å¾å…·é«”äº‹ä»¶ä¸­æç…‰å‡ºæ·±åˆ»çš„äººç”Ÿé“ç†æˆ–åƒ¹å€¼è§€ï¼Œå¼•ç™¼è®€è€…å…±é³´ã€‚", required: "A_ONLY" }
    ];

    const SECTIONS_A = [
        {id: "intro",       title: "ğŸ‘©â€ğŸ« æ•™å¸«å¼•å°"},
        {id: "prompt",      title: "ğŸ“ é¡Œç›®æ‹†è§£"},
        {id: "structure",   title: "ğŸš€ å¤§ç¶±é•·ç›¸"},
        {id: "inspiration", title: "ğŸ’¡ éˆæ„Ÿæ€¥æ•‘"},
        {id: "demo",        title: "ğŸ”¥ å¯¦æˆ°ç¤ºç¯„"},
        {id: "checklist",   title: "âœ… è‡ªæª¢æ¸…å–®"},
        {id: "quiz",        title: "ğŸ® äº’å‹•æ¸¬é©—"}
    ];
    const SECTIONS_B = SECTIONS_A; // å¦‚æœªä¾† B çµ„è¦ä¸åŒç« ç¯€ï¼Œå¯åˆ†é–‹å®šç¾©

    const QUIZ_QUESTIONS_A = [
        {
            id: 1,
            question: "é¡Œç›®å¯«ã€Œå› ç‚ºé€™ä¸€å¤©çš„ç¶“æ­·ã€ï¼Œä¸‹é¢å“ªä¸€ç¨®ç´ ææœ€é©åˆï¼Ÿ",
            options: [
                { text: "å¾å°åˆ°å¤§æ‰€æœ‰è€ƒè©¦çš„ç¶“æ­·", isCorrect: false },
                { text: "æŸä¸€å¤©åœ¨çƒå ´è¼¸æ‰æ¯”è³½çš„ç¶“æ­·", isCorrect: true },
                { text: "æœªä¾†æƒ³åƒè‡ªå·±æˆç‚ºåäººçš„æ•…äº‹", isCorrect: false },
                { text: "å®¶äººä¸‰å¹´å‰æ—…è¡Œçš„å›æ†¶", isCorrect: false }
            ],
            explanation: "é—œéµåœ¨ã€Œé€™ä¸€å¤©ã€èˆ‡ã€Œç¶“æ­·ã€ï¼Œç´ ææ‡‰èšç„¦åœ¨ä¸€å€‹å…·é«”æ—¥å­çš„äº‹ä»¶ã€‚"
        },
        {
            id: 2,
            question: "è‹¥æ–‡ç« ä¸»é¡Œæ˜¯ã€Œæ”¹æ‰è¡å‹•ã€ï¼Œä¸‹é¢å“ªå€‹åšæ³•æœ€è²¼é¡Œï¼Ÿ",
            options: [
                { text: "æ±ºå®šæ¯å¤©æ—©èµ·é‹å‹•ã€‚", isCorrect: false },
                { text: "é‡åˆ°ä¸æ»¿æ™‚æ·±å‘¼å¸ä¸‰ä¸‹ï¼Œå†æ±ºå®šè¦ä¸è¦å›æ‡‰ã€‚", isCorrect: true },
                { text: "åŠªåŠ›å­˜éŒ¢è²·æ–°æ‰‹æ©Ÿã€‚", isCorrect: false },
                { text: "è€ƒæ…®è½‰ç­åˆ°å¦ä¸€æ‰€å­¸æ ¡ã€‚", isCorrect: false }
            ],
            explanation: "é¡Œç›®çš„ç›®æ¨™æ˜¯ã€Œæ”¹æ‰è¡å‹•çš„æ€§æ ¼ã€ï¼Œæ‡‰å¯«å‡ºèˆ‡æƒ…ç·’ç®¡ç†ã€è¡Œç‚ºæ§åˆ¶ç›¸é—œçš„è¡Œå‹•ã€‚"
        }
    ];
    const QUIZ_QUESTIONS_B = QUIZ_QUESTIONS_A;

    // ---------------- State ----------------
    const state = {
        activeGroup: "A",
        fontSize: 20,
        showHighlights: true,
        isNavOpen: true,

        // Concrete vs Vague Game
        cvIndex: 0,
        cvScore: 0,

        // Timer
        timerExpanded: false,
        timerTotalSeconds: 0,
        timerLeft: 0,
        timerRunning: false,
        timerInterval: null,
        timerDragging: false,
        timerDragOffset: {x: 0, y: 0},

        // Checklist
        checklistState: {},

        // Quiz
        quizIndex: 0,
        quizScore: 0,
        quizFinished: false,
        quizSelectedIndex: null
    };

    // ---------------- Helpers ----------------
    const $ = (id) => document.getElementById(id);
    const $qs = (sel) => document.querySelector(sel);
    const $qsa = (sel) => document.querySelectorAll(sel);

    function scrollToSection(id) {
        const el = $(id);
        if (!el) return;
        el.scrollIntoView({behavior: "smooth"});
    }

    function saveChecklist() {
        localStorage.setItem(
            `dse_checklist_${state.activeGroup}`,
            JSON.stringify(state.checklistState)
        );
    }
    function loadChecklist() {
        const s = localStorage.getItem(`dse_checklist_${state.activeGroup}`);
        state.checklistState = s ? JSON.parse(s) : {};
    }

    // ---------------- Sidebar ----------------
    function renderSidebar() {
        const nav = $("sidebar-nav");
        nav.innerHTML = "";
        const sections = state.activeGroup === "A" ? SECTIONS_A : SECTIONS_B;
        sections.forEach(sec => {
            const btn = document.createElement("button");
            btn.textContent = sec.title;
            btn.dataset.target = sec.id;
            btn.addEventListener("click", () => {
                $qsa(".sidebar-nav button").forEach(b => b.classList.remove("active"));
                btn.classList.add("active");
                scrollToSection(sec.id);
            });
            nav.appendChild(btn);
        });
        // åˆå§‹ active
        const firstBtn = nav.querySelector("button");
        if (firstBtn) firstBtn.classList.add("active");
    }

    function updateLayoutForSidebar() {
        const main = $("main-content");
        if (state.isNavOpen) {
            $("sidebar").classList.remove("collapsed");
            main.classList.remove("compact");
            $("chevron-open").classList.remove("hidden");
            $("chevron-closed").classList.add("hidden");
        } else {
            $("sidebar").classList.add("collapsed");
            main.classList.add("compact");
            $("chevron-open").classList.add("hidden");
            $("chevron-closed").classList.remove("hidden");
        }
    }

    // ---------------- Font & highlight ----------------
    function applyFontSize() {
        document.body.style.fontSize = `${state.fontSize}px`;
        $("font-size-label").textContent = `${state.fontSize}px`;
    }

    function applyHighlightVisibility() {
        const hls = document.querySelectorAll(".hl");
        hls.forEach(el => {
            if (state.showHighlights) {
                el.style.background = "#fde68a";
                el.style.border = "2px solid #000";
                el.style.padding = "0 0.15rem";
            } else {
                el.style.background = "transparent";
                el.style.border = "none";
                el.style.padding = "0";
            }
        });
    }

    // ---------------- Floating Timer ----------------
    function formatTime(sec) {
        const m = Math.floor(sec / 60);
        const s = sec % 60;
        return `${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
    }

    function renderTimer(explicitRenderHeader = false) {
        const timer = $("floating-timer");
        timer.innerHTML = "";
        if (!state.timerExpanded) {
            // ç¸®å°åœ–ç¤º
            const icon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            icon.setAttribute("viewBox", "0 0 24 24");
            icon.setAttribute("fill", "none");
            icon.setAttribute("stroke", "currentColor");
            icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 8v4l3 3m1-9V5a1 1 0 00-1-1h-1V3a1 1 0 10-2 0v1H9a1
                     1 0 00-1 1v1m11 4a9 9 0 11-18 0 9 9 0 0118 0z"/>`;
            timer.appendChild(icon);
            timer.classList.remove("expanded");
            timer.onclick = () => {
                state.timerExpanded = true;
                if (!state.timerTotalSeconds) {
                    state.timerTotalSeconds = 5 * 60;
                    state.timerLeft = state.timerTotalSeconds;
                }
                renderTimer(true);
            };
        } else {
            timer.classList.add("expanded");
            // header
            const header = document.createElement("div");
            header.className = "floating-timer-header";
            const title = document.createElement("span");
            title.textContent = "è¨ˆæ™‚å™¨";
            const closeBtn = document.createElement("button");
            closeBtn.className = "timer-icon-btn";
            closeBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                     viewBox="0 0 24 24" stroke="currentColor">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                           d="M6 18L18 6M6 6l12 12"/>
                </svg>
            `;
            closeBtn.onclick = (e) => {
                e.stopPropagation();
                state.timerExpanded = false;
                renderTimer(true);
            };
            header.appendChild(title);
            header.appendChild(closeBtn);
            timer.appendChild(header);

            // progress
            const progress = document.createElement("div");
            progress.className = "timer-progress";
            const fill = document.createElement("div");
            fill.id = "timer-progress-fill";
            fill.className = "timer-progress-fill";
            progress.appendChild(fill);
            timer.appendChild(progress);

            // display
            const display = document.createElement("div");
            display.id = "timer-display";
            display.textContent = formatTime(state.timerLeft || state.timerTotalSeconds || 0);
            timer.appendChild(display);

            // controls
            const controls = document.createElement("div");
            controls.className = "timer-controls";
            const btnStart = document.createElement("button");
            btnStart.className = "btn-brutal";
            btnStart.textContent = "é–‹å§‹";
            const btnPause = document.createElement("button");
            btnPause.className = "btn-brutal";
            btnPause.textContent = "æš«åœ";
            const btnReset = document.createElement("button");
            btnReset.className = "btn-brutal";
            btnReset.textContent = "é‡ç½®";
            controls.appendChild(btnStart);
            controls.appendChild(btnPause);
            controls.appendChild(btnReset);
            timer.appendChild(controls);

            btnStart.onclick = (e) => {
                e.stopPropagation();
                startTimer();
            };
            btnPause.onclick = (e) => {
                e.stopPropagation();
                pauseTimer();
            };
            btnReset.onclick = (e) => {
                e.stopPropagation();
                resetTimer();
            };
        }
    }

    function updateTimerVisual() {
        const fill = $("timer-progress-fill");
        const display = $("timer-display");
        if (!fill || !display) return;
        display.textContent = formatTime(state.timerLeft);
        const ratio = state.timerLeft / state.timerTotalSeconds;
        if (ratio <= 0.2) {
            fill.style.borderTopColor = "#ef4444";
        } else if (ratio <= 0.5) {
            fill.style.borderTopColor = "#f97316";
        } else {
            fill.style.borderTopColor = "#000000";
        }
    }

    function beepOnce() {
        try {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.type = "square";
            osc.frequency.value = 880;
            osc.connect(gain);
            gain.connect(ctx.destination);
            gain.gain.setValueAtTime(0.3, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
            osc.start();
            osc.stop(ctx.currentTime + 0.15);
        } catch (e) {
            // ignore on unsupported browsers
        }
    }

    function startTimer() {
        if (state.timerRunning) return;
        if (!state.timerTotalSeconds) {
            state.timerTotalSeconds = 5 * 60;
            state.timerLeft = state.timerTotalSeconds;
        }
        state.timerRunning = true;
        $("floating-timer").classList.remove("animate-shake");
        state.timerInterval = setInterval(() => {
            state.timerLeft--;
            if (state.timerLeft <= 0) {
                state.timerLeft = 0;
                updateTimerVisual();
                clearInterval(state.timerInterval);
                state.timerRunning = false;
                beepOnce();
                $("floating-timer").classList.add("animate-shake");
            } else {
                updateTimerVisual();
            }
        }, 1000);
    }
    function pauseTimer() {
        if (!state.timerRunning) return;
        state.timerRunning = false;
        clearInterval(state.timerInterval);
    }
    function resetTimer() {
        clearInterval(state.timerInterval);
        state.timerRunning = false;
        state.timerLeft = state.timerTotalSeconds || 5 * 60;
        updateTimerVisual();
        $("floating-timer").classList.remove("animate-shake");
    }

    function initTimerDrag() {
        const el = $("floating-timer");
        let startX = 0, startY = 0;
        el.addEventListener("mousedown", (e) => {
            if (state.timerExpanded) return; // å±•é–‹ç‹€æ…‹ä¸æ‹–å‹•
            state.timerDragging = true;
            startX = e.clientX - el.offsetLeft;
            startY = e.clientY - el.offsetTop;
        });
        window.addEventListener("mousemove", (e) => {
            if (!state.timerDragging) return;
            const x = Math.max(0, Math.min(window.innerWidth - el.offsetWidth, e.clientX - startX));
            const y = Math.max(0, Math.min(window.innerHeight - el.offsetHeight, e.clientY - startY));
            el.style.left = x + "px";
            el.style.top = y + "px";
        });
        window.addEventListener("mouseup", () => {
            state.timerDragging = false;
        });
    }

    // ---------------- Concrete vs Vague Game (ç°¡åŒ–ç‰ˆï¼Œæ”¾åœ¨ Prompt å€) ----------------
    function renderConcreteVsVagueGame(container) {
        const questions = state.activeGroup === "A" ? GAME_QUESTIONS_A : GAME_QUESTIONS_B;
        const q = questions[state.cvIndex];
        container.innerHTML = "";

        const titleRow = document.createElement("div");
        titleRow.className = "flex justify-between items-center mb-2";
        const left = document.createElement("div");
        left.textContent = "ğŸ”¥ ç©ºæ³› VS å…·é«”ï¼šç«çœ¼é‡‘ç›";
        left.className = "font-black";
        const right = document.createElement("div");
        right.textContent = `${state.cvIndex + 1} / ${questions.length}`;
        right.className = "text-sm font-bold";
        titleRow.appendChild(left);
        titleRow.appendChild(right);
        container.appendChild(titleRow);

        const card = document.createElement("div");
        card.className = "card-brutal mb-2";
        card.style.padding = "0.75rem 1rem";
        card.innerHTML = `<p style="text-align:center;font-weight:900;">ã€Œ${q.text}ã€</p>`;
        container.appendChild(card);

        const btnRow = document.createElement("div");
        btnRow.className = "flex gap-2";
        const btnVague = document.createElement("button");
        btnVague.className = "btn-brutal w-full";
        btnVague.textContent = "å¤ªç©ºæ³›";
        const btnConcrete = document.createElement("button");
        btnConcrete.className = "btn-brutal w-full";
        btnConcrete.textContent = "å¾ˆå…·é«”";
        btnRow.appendChild(btnVague);
        btnRow.appendChild(btnConcrete);
        container.appendChild(btnRow);

        const feedback = document.createElement("div");
        feedback.className = "mt-2 text-sm font-bold";
        container.appendChild(feedback);

        function handleAnswer(choiceType) {
            const correct = q.type === choiceType;
            if (correct) state.cvScore++;
            feedback.textContent = (correct ? "âœ” ç­”å°äº†ï¼ " : "âœ˜ ç­”éŒ¯äº†ï¼ ") + q.explanation;
            feedback.style.color = correct ? "#16a34a" : "#dc2626";

            setTimeout(() => {
                state.cvIndex++;
                if (state.cvIndex >= questions.length) {
                    container.innerHTML = `
                        <div class="card-brutal" style="padding:0.75rem 1rem;">
                            <p class="font-black mb-2">éŠæˆ²å®Œæˆï¼</p>
                            <p class="text-sm">ä½ çš„å¾—åˆ†ï¼š${state.cvScore} / ${questions.length}</p>
                            <button id="cv-restart" class="btn-brutal mt-2">é‡æ–°æŒ‘æˆ°</button>
                        </div>
                    `;
                    $("cv-restart").onclick = () => {
                        state.cvIndex = 0;
                        state.cvScore = 0;
                        renderConcreteVsVagueGame(container);
                    };
                } else {
                    renderConcreteVsVagueGame(container);
                }
            }, 1400);
        }

        btnVague.onclick = () => handleAnswer("vague");
        btnConcrete.onclick = () => handleAnswer("concrete");
    }

    // ---------------- Prompt Gameï¼ˆåªåš Lv.1 é—œéµè©ç¤ºæ„ï¼‰ ----------------
    function renderPromptGameShell() {
        const root = $("prompt-content");
        root.innerHTML = "";

        const info = PROMPT_INFO_B;
        const top = document.createElement("div");
        top.className = "card-brutal mb-2";
        top.style.padding = "0.75rem 1rem";
        top.innerHTML = `
            <p class="font-black mb-1">é¡Œç›®ï¼š</p>
            <p>${info.fullTitle}</p>
            <p class="font-black mt-2 mb-1">åŸºæœ¬è¦æ±‚ï¼š</p>
            <ul style="margin:0;padding-left:1.25rem;font-size:0.9rem;">
                ${info.requirements.map(r => `<li>${r}</li>`).join("")}
            </ul>
        `;
        root.appendChild(top);

        const lvl1 = document.createElement("div");
        lvl1.className = "card-brutal mb-2";
        lvl1.style.padding = "0.75rem 1rem";
        const wordsRow = document.createElement("div");
        wordsRow.className = "flex gap-2";
        wordsRow.style.flexWrap = "wrap";
        info.gameWords.forEach(w => {
            const btn = document.createElement("button");
            btn.className = "btn-brutal text-sm";
            btn.textContent = w.text;
            btn.dataset.id = w.id;
            btn.dataset.important = w.important ? "1" : "0";
            btn.style.background = w.important ? "#facc15" : "#e5e7eb";
            btn.onclick = () => {
                btn.classList.toggle("selected-word");
                if (btn.classList.contains("selected-word")) {
                    btn.style.transform = "translateY(-2px)";
                } else {
                    btn.style.transform = "none";
                }
            };
            wordsRow.appendChild(btn);
        });
        const checkBtn = document.createElement("button");
        checkBtn.className = "btn-brutal mt-2";
        checkBtn.textContent = "ç¢ºèªé—œéµè©é¸æ“‡";
        const feedback = document.createElement("div");
        feedback.className = "mt-2 text-sm font-bold";

        lvl1.innerHTML = `<p class="font-black mb-1">Lv.1ï¼šæ‰¾å‡ºé¡Œç›®ä¸­çš„é—œéµè©</p>`;
        lvl1.appendChild(wordsRow);
        lvl1.appendChild(checkBtn);
        lvl1.appendChild(feedback);
        root.appendChild(lvl1);

        checkBtn.onclick = () => {
            const selected = Array.from(wordsRow.children).filter(b => b.classList.contains("selected-word"));
            const correctIds = info.gameWords.filter(w => w.important).map(w => String(w.id));
            const selectedIds = selected.map(b => b.dataset.id);
            const allCorrect =
                correctIds.length === selectedIds.length &&
                correctIds.every(id => selectedIds.includes(id));

            if (allCorrect) {
                feedback.textContent = "âœ” å…¨éƒ¨é—œéµè©éƒ½æ‰¾å°äº†ï¼";
                feedback.style.color = "#16a34a";
            } else {
                const correctCount = selectedIds.filter(id => correctIds.includes(id)).length;
                feedback.textContent = `ç›®å‰åªæ‰¾å° ${correctCount} å€‹ï¼Œè«‹å†æª¢æŸ¥é¡Œç›®é—œæ–¼ã€Œæ™‚é–“ã€ã€Œç¶“æ­·ã€ã€Œç›®æ¨™ã€çš„è¦æ±‚ã€‚`;
                feedback.style.color = "#dc2626";
            }
        };

        // åœ¨ Prompt å€å†åµŒå…¥ Concrete vs Vague éŠæˆ²ï¼ˆç¤ºæ„æ•´åˆå¤šæ¨¡çµ„ï¼‰
        const gameContainer = document.createElement("div");
        gameContainer.className = "mt-4";
        root.appendChild(gameContainer);
        state.cvIndex = 0;
        state.cvScore = 0;
        renderConcreteVsVagueGame(gameContainer);
    }

    // ---------------- Checklist ----------------
    function renderChecklist() {
        const root = $("checklist-content");
        root.innerHTML = "";

        const titleSelf = document.createElement("p");
        titleSelf.textContent = "å¯«ä½œå‰ï¼šè‡ªæˆ‘æª¢æŸ¥";
        titleSelf.className = "font-black mb-2";
        root.appendChild(titleSelf);

        CHECKLIST_ITEMS.forEach((txt, idx) => {
            const row = document.createElement("div");
            row.className = "checklist-item";
            const input = document.createElement("input");
            input.type = "checkbox";
            input.id = `chk-${idx}`;
            input.checked = !!state.checklistState[idx];
            const label = document.createElement("label");
            label.htmlFor = input.id;
            label.textContent = txt;
            row.appendChild(input);
            row.appendChild(label);
            root.appendChild(row);

            input.onchange = () => {
                state.checklistState[idx] = input.checked;
                saveChecklist();
            };
        });
    }

    // ---------------- Learning Objectives Accordion ----------------
    function renderLearningObjectives() {
        const mount = $("lo-accordion-root");
        mount.innerHTML = "";
        const box = document.createElement("div");
        box.className = "lo-accordion";

        const header = document.createElement("div");
        header.className = "lo-accordion-header";
        header.innerHTML = `
            <span>
                <span style="display:inline-block;width:22px;height:22px;border-radius:999px;
                             background:#000;color:#fff;text-align:center;font-size:0.8rem;">ğŸ¯</span>
                <span>æœ¬å–®å…ƒå­¸ç¿’ç›®æ¨™éšæ¢¯ (Learning Objectives)</span>
            </span>
            <span id="lo-toggle-icon">ï¼‹</span>
        `;
        box.appendChild(header);

        const body = document.createElement("div");
        body.className = "lo-accordion-body hidden";
        LEARNING_OBJECTIVES.forEach(obj => {
            const row = document.createElement("div");
            row.className = "lo-item";
            const tag = document.createElement("div");
            tag.className = "lo-item-tag";
            tag.textContent = obj.level;
            tag.style.background = obj.required === "A_ONLY" ? "#fbbf24" : "#000";
            tag.style.color = obj.required === "A_ONLY" ? "#000" : "#fff";

            const content = document.createElement("div");
            content.className = "lo-item-content";
            const h4 = document.createElement("h4");
            h4.textContent = obj.title;
            const extra = document.createElement("span");
            extra.className = "text-sm";
            extra.style.marginLeft = "0.4rem";
            extra.style.fontWeight = "700";
            if (obj.required === "A_ONLY") {
                extra.textContent = "A çµ„æŒ‘æˆ°";
                extra.style.color = "#b91c1c";
            } else {
                extra.textContent = "AB çµ„å¿…ä¿®";
                extra.style.color = "#4b5563";
            }
            const p = document.createElement("p");
            p.textContent = obj.desc;
            content.appendChild(h4);
            content.appendChild(extra);
            content.appendChild(p);

            row.appendChild(tag);
            row.appendChild(content);
            body.appendChild(row);
        });
        box.appendChild(body);
        mount.appendChild(box);

        header.onclick = () => {
            body.classList.toggle("hidden");
            $("lo-toggle-icon").textContent = body.classList.contains("hidden") ? "ï¼‹" : "ï¼";
        };
    }

    // ---------------- Quiz ----------------
    function renderQuiz() {
        const root = $("quiz-content");
        root.innerHTML = "";
        const questions = state.activeGroup === "A" ? QUIZ_QUESTIONS_A : QUIZ_QUESTIONS_B;

        if (state.quizFinished) {
            const card = document.createElement("div");
            card.className = "card-brutal";
            card.style.padding = "0.75rem 1rem";
            card.innerHTML = `
                <p class="font-black mb-2">æ¸¬é©—å®Œæˆï¼</p>
                <p class="text-sm">ä½ çš„å¾—åˆ†ï¼š${state.quizScore} / ${questions.length}</p>
                <button id="quiz-restart" class="btn-brutal mt-2">é‡æ–°é–‹å§‹</button>
            `;
            root.appendChild(card);
            $("quiz-restart").onclick = () => {
                state.quizIndex = 0;
                state.quizScore = 0;
                state.quizFinished = false;
                renderQuiz();
            };
            return;
        }

        const q = questions[state.quizIndex];
        const card = document.createElement("div");
        card.className = "card-brutal";
        card.style.padding = "0.75rem 1rem";

        const head = document.createElement("div");
        head.className = "flex justify-between items-center mb-2";
        head.innerHTML = `
            <span class="text-sm font-bold">ç¬¬ ${state.quizIndex + 1} é¡Œ / å…± ${questions.length} é¡Œ</span>
            <span class="text-sm font-bold">ç›®å‰å¾—åˆ†ï¼š${state.quizScore}</span>
        `;
        card.appendChild(head);

        const p = document.createElement("p");
        p.textContent = q.question;
        p.className = "font-bold mb-2";
        card.appendChild(p);

        const optWrap = document.createElement("div");
        q.options.forEach((opt, idx) => {
            const btn = document.createElement("button");
            btn.className = "btn-brutal w-full mb-2 text-left";
            btn.textContent = opt.text;
            btn.onclick = () => {
                if (opt.isCorrect) {
                    btn.style.background = "#bbf7d0";
                    state.quizScore++;
                } else {
                    btn.style.background = "#fecaca";
                    const correctBtn = optWrap.children[
                        q.options.findIndex(o => o.isCorrect)
                    ];
                    if (correctBtn) correctBtn.style.background = "#bbf7d0";
                }
                setTimeout(() => {
                    state.quizIndex++;
                    if (state.quizIndex >= questions.length) {
                        state.quizFinished = true;
                    }
                    renderQuiz();
                }, 1200);
            };
            optWrap.appendChild(btn);
        });
        card.appendChild(optWrap);

        const exp = document.createElement("p");
        exp.className = "text-sm mt-2";
        exp.style.fontStyle = "italic";
        exp.textContent = "ç­”é¡Œå¾Œå°‡è‡ªå‹•é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆèˆ‡è§£æã€‚";
        card.appendChild(exp);

        root.appendChild(card);
    }

    // ---------------- Group åˆ‡æ› ----------------
    function setActiveGroup(group) {
        if (state.activeGroup === group) return;
        state.activeGroup = group;

        $("group-A").classList.toggle("active", group === "A");
        $("group-B").classList.toggle("active", group === "B");
        $("current-group-label").textContent =
            `ç•¶å‰æ¨¡å¼ï¼š${group === "A" ? "A çµ„æŒ‘æˆ°" : "B çµ„é€šéš"}`;

        // é‡æ–°è¼‰å…¥ checklist ç‹€æ…‹
        loadChecklist();
        renderChecklist();
        renderQuiz();

        // Prompt éŠæˆ²é‡ç½®
        state.cvIndex = 0;
        state.cvScore = 0;
        renderPromptGameShell();
    }

    // ---------------- Init ----------------
    function bindEvents() {
        $("nav-toggle").onclick = () => {
            state.isNavOpen = !state.isNavOpen;
            updateLayoutForSidebar();
        };

        $("group-A").onclick = () => setActiveGroup("A");
        $("group-B").onclick = () => setActiveGroup("B");

        $("fontSlider").oninput = (e) => {
            state.fontSize = parseInt(e.target.value, 10);
            applyFontSize();
        };

        $("highlight-toggle").onclick = () => {
            state.showHighlights = !state.showHighlights;
            applyHighlightVisibility();
        };
    }

    function init() {
        // Layout & sidebar
        renderSidebar();
        updateLayoutForSidebar();

        // Font & highlight
        applyFontSize();
        applyHighlightVisibility();

        // Timer
        state.timerTotalSeconds = 5 * 60;
        state.timerLeft = state.timerTotalSeconds;
        renderTimer(true);
        initTimerDrag();

        // Checklist
        loadChecklist();
        renderChecklist();

        // Learning objectives
        renderLearningObjectives();

        // Prompt + Concrete vs Vague
        renderPromptGameShell();

        // Quiz
        renderQuiz();
    }

    document.addEventListener("DOMContentLoaded", () => {
        bindEvents();
        init();
    });
})();
</script>
</body>
</html>
